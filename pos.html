<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>POS Caja</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
</head>
<body class="p-4 bg-dark text-white">
    <div style="max-width: 400px; margin: auto;">
        <h3>ðŸ›’ CAJA POS</h3>
        <input type="text" id="cli" class="form-control mb-2" placeholder="Nombre Cliente">
        <textarea id="ped" class="form-control mb-3" placeholder="Pedido (Escribe o usa botones)"></textarea>
        <button class="btn btn-success w-100 py-3 fw-bold" onclick="mandar()">ENVIAR A COCINA</button>
        <h1 id="folio-view" class="text-center mt-4 text-warning"></h1>
    </div>

<script>
    const ably = new Ably.Realtime('DTn3Xw.LRKcmg:kyc7qhpjvAETzWfzWTVNnLerapobqPaCivYdBVk97OA');
    const canal = ably.channels.get('canal-operativo-menu');
    let miIdActual = 0;

    function mandar() {
        const cli = document.getElementById('cli').value;
        const ped = document.getElementById('ped').value;
        if(!cli || !ped) return alert("Falta info");
        
        miIdActual = Date.now();
        const data = { 
            id: miIdActual, 
            nombre: cli, 
            alimentos: ped, // AquÃ­ puedes separar por Ã¡rea si gustas
            presencial: true 
        };

        canal.publish('nuevo-pedido', data, () => {
            document.getElementById('folio-view').innerText = "ESPERANDO...";
        });
    }

    // ESCUCHAR EL FOLIO QUE REGRESA DESPACHO
    canal.subscribe('folio-asignado', (m) => {
        if(m.data.id == miIdActual) {
            document.getElementById('folio-view').innerText = "FOLIO: #" + m.data.folio;
            alert("Pedido enviado! Folio: #" + m.data.folio);
            document.getElementById('cli').value = "";
            document.getElementById('ped').value = "";
        }
    });
</script>
</body>
</html>
