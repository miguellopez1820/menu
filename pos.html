<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Punto de Venta - Dash Food</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        body { background: #f4f7f6; display: flex; height: 100vh; overflow: hidden; }
        .menu-side { flex: 1; overflow-y: auto; padding: 20px; }
        .cart-side { width: 400px; background: white; border-left: 1px solid #ddd; display: flex; flex-direction: column; }
        .item-btn { height: 100px; font-weight: bold; font-size: 1.1rem; border-radius: 12px; }
    </style>
</head>
<body>

    <div class="menu-side">
        <h2 class="fw-bold mb-4">ğŸ›’ Punto de Venta (Presencial)</h2>
        <div class="row g-3" id="botones-menu">
            </div>
    </div>

    <div class="cart-side p-4 shadow-lg">
        <h4 class="fw-bold mb-4">Ticket Actual</h4>
        <div id="lista-carrito" class="flex-grow-1 overflow-auto small mb-3">
            </div>
        
        <div class="mb-3">
            <select id="tipo-servicio" class="form-select mb-2 fw-bold">
                <option value="Comer AquÃ­">ğŸ“ Comer AquÃ­</option>
                <option value="Para Llevar">ğŸ¥¡ Para Llevar</option>
            </select>
            <input type="text" id="nombre-cliente" class="form-control mb-2" placeholder="Nombre del cliente o Mesa">
            <select id="metodo-pago" class="form-select fw-bold">
                <option value="Efectivo">ğŸ’µ Efectivo</option>
                <option value="Tarjeta">ğŸ’³ Tarjeta</option>
            </select>
        </div>

        <div class="border-top pt-3">
            <div class="d-flex justify-content-between h3 fw-bold text-success">
                <span>TOTAL:</span>
                <span id="total-txt">$0</span>
            </div>
            <button onclick="mandarCocina()" class="btn btn-dark w-100 py-3 mt-2 fw-bold fs-5">ENVIAR A COCINA ğŸ”¥</button>
            <button onclick="limpiar()" class="btn btn-outline-danger w-100 mt-2">Cancelar</button>
        </div>
    </div>

<script>
    const ably = new Ably.Realtime('DTn3Xw.LRKcmg:kyc7qhpjvAETzWfzWTVNnLerapobqPaCivYdBVk97OA');
    const canal = ably.channels.get('pedidos-dash');

    const menu = [
        { id: "h1", nom: "Hamb. Hawaiana", pre: 135, area: "Alimentos" },
        { id: "h2", nom: "Hamb. BBQ", pre: 155, area: "Alimentos" },
        { id: "a1", nom: "Alitas 10 pz", pre: 160, area: "Snacks" },
        { id: "b1", nom: "Bionico", pre: 65, area: "Snacks" }
    ];

    let cart = []; let total = 0;

    // Generar botones de menÃº
    const cont = document.getElementById('botones-menu');
    menu.forEach(p => {
        cont.innerHTML += `<div class="col-md-4">
            <button class="btn btn-outline-primary w-100 item-btn shadow-sm" onclick="add('${p.id}')">${p.nom}<br>$${p.pre}</button>
        </div>`;
    });

    function add(id) {
        const p = menu.find(x => x.id === id);
        cart.push(p);
        actualizar();
    }

    function actualizar() {
        const list = document.getElementById('lista-carrito');
        list.innerHTML = ""; total = 0;
        cart.forEach((p, index) => {
            total += p.pre;
            list.innerHTML += `<div class="d-flex justify-content-between mb-1 border-bottom pb-1">
                <span>${p.nom}</span>
                <b>$${p.pre} <span class="text-danger" onclick="borrar(${index})" style="cursor:pointer">âœ•</span></b>
            </div>`;
        });
        document.getElementById('total-txt').innerText = `$${total}`;
    }

    function borrar(idx) { cart.splice(idx, 1); actualizar(); }

    function mandarCocina() {
        const nom = document.getElementById('nombre-cliente').value;
        if(!nom || cart.length === 0) return alert("Falta cliente o productos");

        let alim = ""; let snacks = "";
        cart.forEach(p => {
            if(p.area === "Alimentos") alim += `1 x ${p.nom}\n`;
            else snacks += `1 x ${p.nom}\n`;
        });

        const data = {
            id: Date.now(), creado: Date.now(),
            nombre: `(PRESENCIAL) ${nom}`,
            tipo: document.getElementById('tipo-servicio').value,
            total: total, alimentos: alim, snacks: snacks,
            pago: document.getElementById('metodo-pago').value,
            direccion: "SERVICIO EN LOCAL",
            presencial: true // Marca para que despacho no le asigne repartidor
        };

        canal.publish('nuevo', data, () => {
            alert("Â¡Pedido enviado!");
            location.reload();
        });
    }
</script>
</body>
</html>