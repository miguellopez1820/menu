<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>COCINA 2 | SNACKS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: 'Arial Black', sans-serif; }
        .header-cocina { background: #28a745; color: white; padding: 20px; text-align: center; border-bottom: 10px solid #1e7e34; }
        .ticket-cocina { background: white; color: black; border-radius: 30px; margin-bottom: 25px; border-top: 15px solid #28a745; }
        .folio-txt { font-size: 6rem; font-weight: 900; color: #1a1a1a; }
        .pedido-detalle { font-size: 3.5rem; font-weight: 800; border-top: 4px solid #eee; padding-top: 10px; }
        .nota-alerta { background: #ffff00; color: #d32f2f; font-size: 3rem; padding: 20px; border-radius: 15px; border: 6px solid #d32f2f; animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
        .btn-listo { font-size: 2.5rem; padding: 20px; border-radius: 20px; font-weight: 900; }
    </style>
</head>
<body class="p-3">
    <div class="header-cocina mb-4">
        <h1 class="display-1 fw-bold">üçø COCINA 2: SNACKS</h1>
    </div>

    <div id="lista-pedidos" class="row g-4"></div>

    <audio id="timbre" src="https://assets.mixkit.co/active_storage/sfx/1000/1000-preview.mp3"></audio>

<script>
    const ably = new Ably.Realtime({ key: 'YOUR_ABLY_KEY' });
    const canal = ably.channels.get('canal-operativo-menu');
    
    canal.subscribe('nuevo-pedido', (m) => {
        const p = m.data;
        // FILTRO: Solo si trae snacks
        if (p.snacks && p.snacks.trim() !== "") {
            document.getElementById('timbre').play();
            dibujarTicket(p);
        }
    });

    canal.subscribe('cancelar-global', m => {
        document.getElementById('t-' + m.data.id)?.remove();
    });

    function dibujarTicket(p) {
        const div = document.createElement('div');
        div.id = `t-${p.id}`;
        div.className = "col-xl-4 col-lg-6";
        
        div.innerHTML = `
            <div class="ticket-cocina p-4">
                <div class="d-flex justify-content-between mb-3">
                    <span class="folio-txt">#${p.folio}</span>
                </div>
                <div class="pedido-detalle">
                    ${p.snacks.replace(/\n/g, '<br>')}
                </div>
                ${p.notas ? `<div class="nota-alerta">‚ö†Ô∏è ${p.notas.toUpperCase()}</div>` : ''}
                <button class="btn btn-success btn-listo w-100 mt-4" onclick="listo('${p.id}')">LISTO ‚úÖ</button>
            </div>`;
        document.getElementById('lista-pedidos').prepend(div);
    }

    function listo(id) {
        document.getElementById('t-' + id).remove();
        canal.publish('status-' + id, { estado: 'preparado' });
    }
</script>
</body>
</html>
