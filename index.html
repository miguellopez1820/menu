<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dash Food - Men칰 Completo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        body { background: #f8f9fa; font-family: 'Segoe UI', sans-serif; padding-bottom: 150px; }
        .categoria-label { background: #000; color: #fff; padding: 8px 15px; border-radius: 20px; font-size: 0.9rem; margin-top: 20px; display: inline-block; }
        .product-card { background: #fff; border-radius: 15px; padding: 12px; margin-bottom: 10px; border: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .btn-qty { width: 35px; height: 35px; border-radius: 10px; border: 1px solid #ddd; background: #fff; font-weight: bold; }
        .cart-footer { background: #fff; position: fixed; bottom: 0; width: 100%; max-width: 500px; padding: 20px; box-shadow: 0 -5px 15px rgba(0,0,0,0.1); border-radius: 25px 25px 0 0; left: 50%; transform: translateX(-50%); }
        .btn-confirm { background: #06C167; color: #fff; border: none; border-radius: 12px; padding: 15px; width: 100%; font-weight: bold; font-size: 1.1rem; }
    </style>
</head>
<body class="d-flex justify-content-center">
    <div style="width: 100%; max-width: 500px;">
        <div id="pantalla-menu">
            <div class="p-4 bg-dark text-white text-center rounded-bottom shadow">
                <h2 class="fw-bold mb-0">Dash Food 游꼢</h2>
                <p class="small mb-0 opacity-75">Selecciona tus favoritos</p>
            </div>

            <div id="contenedor-menu" class="p-3">
                </div>

            <div class="p-3 bg-white mx-3 rounded-4 shadow-sm mb-4">
                <h6 class="fw-bold">Datos de Entrega:</h6>
                <input type="text" id="nombre" class="form-control mb-2" placeholder="Tu nombre">
                <textarea id="direccion" class="form-control mb-2" placeholder="Direcci칩n y referencias"></textarea>
            </div>

            <div class="cart-footer">
                <div class="d-flex justify-content-between mb-3 px-2">
                    <span class="fs-5">Total a pagar:</span>
                    <span class="fs-5 fw-bold text-success" id="total-txt">$0.00</span>
                </div>
                <button onclick="enviarPedido()" class="btn-confirm shadow">CONFIRMAR PEDIDO</button>
            </div>
        </div>

        <div id="pantalla-tracking" class="p-4 d-none text-center">
            <h3 class="fw-bold">Orden #<span id="folio-display">--</span></h3>
            <div id="status-box" class="mt-4 text-start">
                </div>
            <a id="btn-ayuda" href="#" target="_blank" class="btn btn-success w-100 mt-4 py-3 fw-bold">Ayuda WhatsApp 游눫</a>
        </div>
    </div>

<script>
    const ably = new Ably.Realtime('DTn3Xw.LRKcmg:kyc7qhpjvAETzWfzWTVNnLerapobqPaCivYdBVk97OA');
    const canal = ably.channels.get('pedidos-dash');

    // AQU칈 AGREGA TODOS LOS PLATILLOS QUE QUIERAS
    const menuData = [
        { cat: "Hamburguesas", items: [
            { id: "h_clasica", nom: "Cl치sica Especial", precio: 120 },
            { id: "h_hawai", nom: "Hawaiana (Pi침a/Jam칩n)", precio: 135 },
            { id: "h_bbq", nom: "Doble BBQ Crunch", precio: 150 },
            { id: "h_mex", nom: "Mexicana (Guacamole)", precio: 140 }
        ]},
        { cat: "Alitas & Boneless", items: [
            { id: "a_bbq", nom: "Alitas BBQ (10 pz)", precio: 160 },
            { id: "a_mango", nom: "Mango Habanero", precio: 165 },
            { id: "a_buffalo", nom: "Buffalo Hot", precio: 160 },
            { id: "b_bbq", nom: "Boneless BBQ", precio: 145 }
        ]},
        { cat: "Bebidas", items: [
            { id: "ref_355", nom: "Refresco 355ml", precio: 35 },
            { id: "agua_fresa", nom: "Agua de Fresa Natural", precio: 45 }
        ]}
    ];

    let carrito = {}; let total = 0;

    // Generar el men칰 visualmente
    const cont = document.getElementById('contenedor-menu');
    menuData.forEach(seccion => {
        cont.innerHTML += `<div class="categoria-label">${seccion.cat}</div>`;
        seccion.items.forEach(p => {
            cont.innerHTML += `
                <div class="product-card">
                    <div><b>${p.nom}</b><br><small class="text-success">$${p.precio}</small></div>
                    <div class="d-flex align-items-center gap-2">
                        <button class="btn-qty" onclick="updateQty('${p.id}', -1, ${p.precio}, '${p.nom}')">-</button>
                        <b id="q-${p.id}">0</b>
                        <button class="btn-qty" onclick="updateQty('${p.id}', 1, ${p.precio}, '${p.nom}')">+</button>
                    </div>
                </div>`;
        });
    });

    function updateQty(id, chg, precio, nombre) {
        if(!carrito[id]) carrito[id] = { cant: 0, nombre: nombre, precio: precio };
        carrito[id].cant = Math.max(0, carrito[id].cant + chg);
        document.getElementById('q-'+id).innerText = carrito[id].cant;
        
        total = 0;
        for(let k in carrito) total += (carrito[k].cant * carrito[k].precio);
        document.getElementById('total-txt').innerText = `$${total}.00`;
    }

    function enviarPedido() {
        const btn = document.querySelector('.btn-confirm');
        const nom = document.getElementById('nombre').value;
        if(!nom || total === 0) return alert("Selecciona productos y escribe tu nombre");

        btn.disabled = true;
        btn.innerText = "ENVIANDO PEDIDO...";

        navigator.geolocation.getCurrentPosition((pos) => {
            const idUnico = Date.now();
            let listaComida = "";
            for(let k in carrito) if(carrito[k].cant > 0) listaComida += `${carrito[k].cant}x ${carrito[k].nombre}, `;

            const data = {
                id: idUnico, nombre: nom, total: total,
                comida: listaComida,
                direccion: document.getElementById('direccion').value,
                gps: `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`
            };

            canal.publish('nuevo', data, (err) => {
                if(err) { btn.disabled = false; return alert("Error de red"); }
                document.getElementById('pantalla-menu').classList.add('d-none');
                document.getElementById('pantalla-tracking').classList.remove('d-none');
                // Suscribirse a estados... (igual al c칩digo anterior)
            });
        });
    }
</script>
</body>
</html>
