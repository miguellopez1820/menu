<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dash Food - Pedido en Vivo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        :root { --uber-green: #06C167; }
        body { background: #f7f7f7; font-family: 'Segoe UI', sans-serif; }
        .app-card { border-radius: 20px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .step { position: relative; padding-left: 50px; margin-bottom: 40px; color: #ccc; transition: 0.4s; }
        .step::before { content: ""; position: absolute; left: 18px; top: 0; bottom: -40px; width: 2px; background: #eee; }
        .step:last-child::before { display: none; }
        .step-icon { position: absolute; left: 0; width: 38px; height: 38px; background: #eee; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1; transition: 0.4s; }
        .active { color: #000; font-weight: bold; }
        .active .step-icon { background: var(--uber-green); color: white; }
    </style>
</head>
<body>

<div id="pantalla-pedido" class="container py-4">
    <h2 class="fw-bold mb-4 text-center">Dash Food üçî</h2>
    <div class="card app-card p-4 shadow">
        <label class="fw-bold small">Tu Nombre:</label>
        <input type="text" id="nombre" class="form-control mb-3" placeholder="Ej: Miguel L√≥pez">
        
        <label class="fw-bold small">Platillo:</label>
        <select id="comida" class="form-select mb-3">
            <option>Hamburguesa Especial - $120</option>
            <option>Pizza Pepperoni - $150</option>
            <option>Alitas BBQ - $130</option>
        </select>

        <label class="fw-bold small">Direcci√≥n:</label>
        <textarea id="direccion" class="form-control mb-4" placeholder="Calle, n√∫mero y referencias"></textarea>
        
        <button onclick="enviarPedido()" class="btn btn-dark w-100 p-3 fw-bold rounded-3">REALIZAR PEDIDO</button>
    </div>
</div>

<div id="pantalla-tracking" class="container py-5 d-none">
    <div class="card app-card p-4 text-center shadow-lg">
        <h4 class="fw-bold mb-5">Estado de tu pedido üõµ</h4>
        <div class="text-start ms-2">
            <div id="step1" class="step active"><div class="step-icon">üì©</div>Pedido Recibido</div>
            <div id="step2" class="step"><div class="step-icon">üî•</div>En Cocina</div>
            <div id="step3" class="step"><div class="step-icon">üõµ</div>En Camino</div>
        </div>
        <p class="text-muted small mt-4">Actualizamos esto en tiempo real por ti.</p>
    </div>
</div>

<script>
    const ably = new Ably.Realtime('DTn3Xw.LRKcmg:kyc7qhpjvAETzWfzWTVNnLerapobqPaCivYdBVk97OA');
    const canal = ably.channels.get('pedidos-dash');
    let idPedido = "ID-" + Math.random().toString(36).substr(2, 6).toUpperCase();
    let gpsLink = "No compartido";

    navigator.geolocation.getCurrentPosition(p => {
        gpsLink = `https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`;
    });

    function enviarPedido() {
        const datos = {
            id: idPedido,
            nombre: document.getElementById('nombre').value,
            comida: document.getElementById('comida').value,
            direccion: document.getElementById('direccion').value,
            gps: gpsLink
        };

        if(!datos.nombre || !datos.direccion) return alert("Completa tus datos, bro");

        // Mandar al Admin
        canal.publish('nuevo', datos);

        // Cambiar vista
        document.getElementById('pantalla-pedido').classList.add('d-none');
        document.getElementById('pantalla-tracking').classList.remove('d-none');

        // Escuchar estados espec√≠ficos de ESTE pedido
        canal.subscribe('status-' + idPedido, (msg) => {
            if(msg.data.estado === 'cocinando') document.getElementById('step2').classList.add('active');
            if(msg.data.estado === 'camino') {
                document.getElementById('step2').classList.add('active');
                document.getElementById('step3').classList.add('active');
            }
        });
    }
</script>
</body>
</html>
