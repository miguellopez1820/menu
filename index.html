<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dash Food - Men√∫</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        body { background: #f8f9fa; font-family: sans-serif; }
        .producto-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .btn-cant { width: 35px; height: 35px; border-radius: 50%; border: 1px solid #ddd; background: white; font-weight: bold; }
        .btn-pedir { background: #000; color: #fff; width: 100%; padding: 15px; border-radius: 15px; font-weight: bold; border: none; margin-top: 20px; }
        .carrito-resumen { background: #e9ecef; border-radius: 10px; padding: 15px; margin-top: 15px; }
    </style>
</head>
<body class="p-3">
    <h2 class="fw-bold mb-4">Dash Food üçî</h2>
    
    <div id="menu">
        <div class="producto-card">
            <div><b>Hamburguesa</b><br><small class="text-muted">$120</small></div>
            <div>
                <button class="btn-cant" onclick="cambiarCant('hamburguesa', -1, 120)">-</button>
                <span id="cant-hamburguesa" class="mx-2">0</span>
                <button class="btn-cant" onclick="cambiarCant('hamburguesa', 1, 120)">+</button>
            </div>
        </div>
        <div class="producto-card">
            <div><b>Pizza Pepperoni</b><br><small class="text-muted">$150</small></div>
            <div>
                <button class="btn-cant" onclick="cambiarCant('pizza', -1, 150)">-</button>
                <span id="cant-pizza" class="mx-2">0</span>
                <button class="btn-cant" onclick="cambiarCant('pizza', 1, 150)">+</button>
            </div>
        </div>
        <div class="producto-card">
            <div><b>Alitas BBQ</b><br><small class="text-muted">$130</small></div>
            <div>
                <button class="btn-cant" onclick="cambiarCant('alitas', -1, 130)">-</button>
                <span id="cant-alitas" class="mx-2">0</span>
                <button class="btn-cant" onclick="cambiarCant('alitas', 1, 130)">+</button>
            </div>
        </div>
    </div>

    <div class="carrito-resumen">
        <b>Total: $<span id="total-cliente">0</span></b>
    </div>

    <input type="text" id="nombre" class="form-control mt-3" placeholder="Tu nombre">
    <textarea id="direccion" class="form-control mt-2" placeholder="Direcci√≥n completa"></textarea>
    <textarea id="notas" class="form-control mt-2" placeholder="Notas (Sin cebolla, etc.)"></textarea>
    
    <button class="btn-pedir" onclick="enviarPedido()">ENVIAR PEDIDO üöÄ</button>

    <script>
        const ably = new Ably.Realtime('DTn3Xw.LRKcmg:kyc7qhpjvAETzWfzWTVNnLerapobqPaCivYdBVk97OA');
        const canal = ably.channels.get('pedidos-dash');
        let carrito = {};
        let totalPagar = 0;

        function cambiarCant(id, cambio, precio) {
            if(!carrito[id]) carrito[id] = 0;
            carrito[id] = Math.max(0, carrito[id] + cambio);
            document.getElementById('cant-'+id).innerText = carrito[id];
            
            // Recalcular total
            totalPagar = (parseInt(document.getElementById('cant-hamburguesa').innerText) * 120) +
                         (parseInt(document.getElementById('cant-pizza').innerText) * 150) +
                         (parseInt(document.getElementById('cant-alitas').innerText) * 130);
            document.getElementById('total-cliente').innerText = totalPagar;
        }

        function enviarPedido() {
            const nombre = document.getElementById('nombre').value;
            const direccion = document.getElementById('direccion').value;
            if(!nombre || totalPagar === 0) return alert("Agrega productos y tu nombre");

            let resumenComida = "";
            if(carrito.hamburguesa > 0) resumenComida += `${carrito.hamburguesa} Haburguesa(s) `;
            if(carrito.pizza > 0) resumenComida += `${carrito.pizza} Pizza(s) `;
            if(carrito.alitas > 0) resumenComida += `${carrito.alitas} Alitas `;

            navigator.geolocation.getCurrentPosition((p) => {
                const gps = `https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`;
                canal.publish('nuevo', {
                    id: Date.now(),
                    nombre: nombre,
                    comida: resumenComida,
                    total: totalPagar, // Enviamos el n√∫mero limpio para el gerente
                    direccion: direccion,
                    notas: document.getElementById('notas').value,
                    gps: gps
                });
                alert("¬°Pedido enviado!");
                location.reload();
            });
        }
    </script>
</body>
</html>
