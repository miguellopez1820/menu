<script>
    // ... (ConfiguraciÃ³n de Ably igual) ...

    canal.subscribe('nuevo', (msg) => {
        const p = msg.data;
        // El folio lo asigna el despacho, pero aquÃ­ lo recibiremos vÃ­a actualizaciÃ³n
        const div = document.createElement('div');
        div.id = `cocina-${p.id}`;
        div.className = "card mb-3 p-3 border-5 border-start border-warning shadow";
        div.innerHTML = `
            <div class="d-flex justify-content-between">
                <h4 class="fw-bold">ORDEN: <span id="folio-cocina-${p.id}" class="text-danger">Pte...</span></h4>
                <span class="badge bg-dark">${new Date().toLocaleTimeString()}</span>
            </div>
            <hr>
            <h2 class="text-uppercase fw-bold">${p.comida}</h2>
            <p class="fs-5">ðŸ‘¤ Cliente: ${p.nombre}</p>
            <button class="btn btn-warning btn-lg w-100 fw-bold" onclick="marcarCocinando('${p.id}')">EMPEZAR A COCINAR ðŸ”¥</button>
            <button class="btn btn-success btn-lg w-100 fw-bold mt-2" onclick="terminarCocina('${p.id}')">LISTO PARA ENTREGA âœ…</button>
        `;
        document.getElementById('lista-pedidos').prepend(div);
    });

    // Escuchar cuando Despacho asigne el folio para mostrarlo en cocina
    canal.subscribe('update-folio', (msg) => {
        const { id, folio } = msg.data;
        const el = document.getElementById(`folio-cocina-${id}`);
        if(el) el.innerText = "#" + folio;
    });

    function marcarCocinando(id) {
        canal.publish('status-' + id, { estado: 'cocinando' });
        alert("Cliente notificado: Cocinando...");
    }
</script>
