<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
</head>
<body class="p-4 bg-light">
    <h2 class="fw-bold">Corte de Caja</h2>
    <div id="repartidores" class="row mb-4"></div>
    <table class="table bg-white rounded shadow-sm">
        <thead><tr><th>Hora</th><th>Repartidor</th><th>Monto</th></tr></thead>
        <tbody id="historial"></tbody>
    </table>

    <script>
        const ably = new Ably.Realtime('DTn3Xw.LRKcmg:kyc7qhpjvAETzWfzWTVNnLerapobqPaCivYdBVk97OA');
        const canal = ably.channels.get('pedidos-dash');
        let saldos = {};

        canal.subscribe('para-gerente', (msg) => {
            const p = msg.data;
            const repa = p.repartidor;
            saldos[repa] = (saldos[repa] || 0) + p.total;
            
            // Dibujar saldos
            let html = "";
            for(let r in saldos) html += `<div class="col-md-3"><div class="card p-3"><b>${r}</b><br><span class="h4 text-success">$${saldos[r]}</span></div></div>`;
            document.getElementById('repartidores').innerHTML = html;

            const fila = `<tr><td>${new Date().toLocaleTimeString()}</td><td>${repa}</td><td>$${p.total}</td></tr>`;
            document.getElementById('historial').innerHTML = fila + document.getElementById('historial').innerHTML;
        });
    </script>
</body>
</html>
