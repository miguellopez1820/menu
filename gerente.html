<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gerencia | Taquer√≠a Leo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        body { background: #1a1a1a; color: white; padding: 25px; }
        .card-corte { background: white; color: black; border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .table-leo { background: white; border-radius: 15px; overflow: hidden; }
    </style>
</head>
<body>
    <div class="d-flex justify-content-between mb-4 align-items-center">
        <h2 class="fw-bold text-warning">üìä AUDITOR√çA DE CAJA</h2>
        <button class="btn btn-danger btn-lg fw-bold" onclick="nuevoDia()">üåû CIERRE DE D√çA (CLAVE)</button>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-3"><div class="card-corte"><h6>EFECTIVO üíµ</h6><h2 id="v-efe">$0</h2></div></div>
        <div class="col-md-3"><div class="card-corte"><h6>TARJETA üí≥</h6><h2 id="v-tar">$0</h2></div></div>
        <div class="col-md-3"><div class="card-corte"><h6>LOCAL üè†</h6><h2 id="v-loc">$0</h2></div></div>
        <div class="col-md-3"><div class="card-corte bg-success text-white"><h6>VENTA TOTAL</h6><h2 id="v-total">$0</h2></div></div>
    </div>

    <div class="table-leo p-3 text-dark">
        <h4 class="fw-bold mb-3 border-bottom pb-2">DETALLE DE FOLIOS</h4>
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr><th>Folio</th><th>Repartidor/Local</th><th>Pago</th><th>Monto (inc. Env√≠o)</th><th>Estatus</th></tr>
            </thead>
            <tbody id="hist"></tbody>
        </table>
    </div>

<script>
    const ably = new Ably.Realtime({ key: 'YOUR_ABLY_KEY' });
    const canal = ably.channels.get('canal-operativo-menu');
    let data = JSON.parse(localStorage.getItem('g_data_v2')) || [];

    actualizar();

    canal.subscribe('registro-gerente', m => {
        data.push(m.data);
        localStorage.setItem('g_data_v2', JSON.stringify(data));
        actualizar();
    });

    function actualizar() {
        const h = document.getElementById('hist'); h.innerHTML = "";
        let loc=0, dom=0, can=0, efe=0, tar=0;
        
        data.forEach(p => {
            if(p.status !== 'cancelado') {
                if(p.presencial) loc += parseFloat(p.total); else dom += parseFloat(p.total);
                if(p.pago === 'Tarjeta') tar += parseFloat(p.total); else efe += parseFloat(p.total);
            } else { can++; }

            h.innerHTML += `
                <tr class="${p.status=='cancelado'?'table-danger':''}">
                    <td>#${p.folio}</td>
                    <td class="fw-bold">${p.chofer_nombre || 'üõí LOCAL'}</td>
                    <td>${p.pago}</td>
                    <td class="text-success fw-bold">$${p.total}</td>
                    <td>${p.status.toUpperCase()}</td>
                </tr>`;
        });
        document.getElementById('v-efe').innerText = `$${efe}`;
        document.getElementById('v-tar').innerText = `$${tar}`;
        document.getElementById('v-loc').innerText = `$${loc}`;
        document.getElementById('v-total').innerText = `$${efe + tar}`;
    }

    function nuevoDia() { if(prompt("CLAVE DE GERENTE:") === "LEO2026") { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
