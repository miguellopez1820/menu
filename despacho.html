<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Despacho Central</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
</head>
<body class="bg-light p-4">
    <h2 class="fw-bold">ðŸ“¦ MONITOR DE DESPACHO</h2>
    <div id="lista" class="row g-3"></div>

<script>
    const ably = new Ably.Realtime('DTn3Xw.LRKcmg:kyc7qhpjvAETzWfzWTVNnLerapobqPaCivYdBVk97OA');
    const canal = ably.channels.get('canal-operativo-menu');
    let folioContador = parseInt(localStorage.getItem('f_num')) || 1;

    canal.subscribe('nuevo-pedido', (m) => {
        const p = m.data;
        p.folio = folioContador++;
        localStorage.setItem('f_num', folioContador);

        // AVISO GLOBAL DE FOLIO (Esto lo escuchan Web, POS y Cocinas)
        canal.publish('folio-asignado', { id: p.id, folio: p.folio });

        const div = document.createElement('div');
        div.id = `d-${p.id}`;
        div.className = "col-md-4";
        div.innerHTML = `
            <div class="card p-3 shadow-sm border-primary">
                <h4>#${p.folio} - ${p.nombre}</h4>
                <div class="bg-light p-2 mb-2 small">${p.alimentos || ''}${p.snacks || ''}</div>
                <button class="btn btn-primary w-100" onclick="this.parentElement.parentElement.remove()">LISTO / ENTREGADO</button>
            </div>`;
        document.getElementById('lista').prepend(div);
    });
</script>
</body>
</html>
